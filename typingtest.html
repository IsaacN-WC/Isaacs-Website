<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Typing Test</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--muted:#94a3b8;--correct:#10b981;--wrong:#ef4444;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#071024 0%, #071a2b 100%);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:24px;
    }

    .container{width:100%;max-width:980px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px}
    header h1{font-size:20px;margin:0}
    .controls{display:flex;gap:10px;align-items:center}
    select,input[type=number]{background:var(--card);border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px;border-radius:8px}
    button{background:var(--accent);border:none;color:white;padding:9px 12px;border-radius:10px;font-weight:600;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}

    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .stats{display:flex;gap:12px;justify-content:space-between;margin-top:12px}
    .stat{flex:1;padding:10px;background:var(--glass);border-radius:10px;text-align:center}
    .stat h3{margin:0;font-size:12px;color:var(--muted)}
    .stat p{margin:6px 0 0;font-size:18px;font-weight:700}

    .text-area{margin-top:14px;padding:14px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border-radius:10px;min-height:110px}
    .target{line-height:1.6;font-size:18px;word-wrap:break-word}
    .target .correct{color:var(--correct)}
    .target .wrong{color:var(--wrong);text-decoration:underline}
    .target .current{border-left:2px solid var(--accent);padding-left:2px}

    textarea{width:100%;margin-top:12px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#071425;color:inherit;min-height:120px;resize:none;font-size:16px}

    footer{margin-top:16px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px}

    @media (max-width:640px){header{flex-direction:column;align-items:flex-start} .stats{flex-direction:column} .controls{width:100%;justify-content:space-between}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Typing Test</h1>
      <div class="controls">
        <button id="start">Start</button>
        <button id="restart" class="secondary">Restart</button>
        <button onclick="window.location.href='index.html'"><strong>Click here to go back to Main Website</strong></button>
      </div>
    </header>

    <main class="card">
      <div class="text-area">
        <div id="target" class="target" aria-live="polite"></div>
      </div>

      <textarea id="input" placeholder="Type here..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" disabled></textarea>

      <div class="stats">
        <div class="stat"><h3>WPM</h3><p id="wpm">0</p></div>
        <div class="stat"><h3>Accuracy</h3><p id="acc">100%</p></div>
        <div class="stat"><h3>Correct</h3><p id="correctCount">0</p></div>
      </div>

      <div id="results" class="card" style="display:none; text-align:center; padding:24px;">
        <h2>Results</h2>
        <p><strong>WPM:</strong> <span id="finalWpm">0</span></p>
        <p><strong>Accuracy:</strong> <span id="finalAcc">0%</span></p>
        <button onclick="restartToTest()">Restart Test</button>
       </div>
      <footer>
        <div id="message">Choose time and press Start. The test will auto-focus when it begins.</div>
      </footer>
    </main>
  </div>

  <script>
    // Sample passages (short). You can extend this array.
    const passages = [
      "The quick brown fox jumps over the lazy dog.",
      "Typing well is a skill that improves with practice and patience.",
      "Small consistent efforts every day lead to big improvements over time.",
      "Creativity often requires quiet and uninterrupted time to flourish.",
      "Learning how to type faster will save you hours in the long run.",
      "Focus on accuracy first, speed will follow as your confidence grows."
    ];

    const targetEl = document.getElementById('target');
    const inputEl = document.getElementById('input');
    const startBtn = document.getElementById('start');
    const restartBtn = document.getElementById('restart');
    const wpmEl = document.getElementById('wpm');
    const accEl = document.getElementById('acc');
    const correctEl = document.getElementById('correctCount');
    const messageEl = document.getElementById('message');

    let timer = null;
    let running = false;
    let startTime = null;
    let totalTyped = 0;
    let correctChars = 0;
    let currentPassage = '';
    let charElements = [];

    function pickPassage(){
        let words = [];
        while(words.length < 30){
        const p = passages[Math.floor(Math.random()*passages.length)];
        words = words.concat(p.split(/\s+/));
        }
    return words.slice(0,30).join(' ');
    }

    function renderTarget(text){
      targetEl.innerHTML = '';
      charElements = [];
      for(let i=0;i<text.length;i++){
        const span = document.createElement('span');
        span.textContent = text[i];
        targetEl.appendChild(span);
        charElements.push(span);
      }
    }

    function resetCounters(){
      clearInterval(timer);
      timer = null;
      running = false;
      startTime = null;
      totalTyped = 0;
      correctChars = 0;
      wpmEl.textContent = '0';
      accEl.textContent = '100%';
      correctEl.textContent = '0';
      inputEl.value = '';
      messageEl.textContent = 'Choose time and press Start. The test will auto-focus when it begins.';
      inputEl.disabled = true;
      // clear classes
      charElements.forEach(s => { s.className = ''; })
    }

    function startTest(){
      if(running) return;
      currentPassage = pickPassage();
      renderTarget(currentPassage);
      resetCounters();
      inputEl.disabled = false;
      inputEl.focus();

      // Start timer
      running = true;
      startTime = Date.now();


      messageEl.textContent = 'Test running — type the text above. Press Restart to try again.';
    }

    function updateStats(final=false){
        const typed = inputEl.value;
        totalTyped = typed.length;
        correctChars = 0;

        for(let i=0;i<charElements.length;i++){
        const span = charElements[i];
        const typedChar = typed[i];
        span.className = '';
        if(typedChar == null){
        // not typed yet
            } else if(typedChar === span.textContent){
            span.classList.add('correct');
            correctChars++;
        } else {
            span.classList.add('wrong');
        }
        }

        // caret highlight
        const pos = Math.min(typed.length, charElements.length-1);
        charElements.forEach((s,idx)=> s.classList.remove('current'));
        if(charElements[pos]) charElements[pos].classList.add('current');

        // WPM = (correct chars / 5) / minutes
        const elapsedSeconds = (Date.now() - startTime) / 1000;
        const minutes = Math.max(1/60, elapsedSeconds/60);
          const wpm = Math.round((correctChars / 5) / minutes);
        const accuracy = totalTyped === 0 ? 100 : Math.max(0, Math.round((correctChars / totalTyped) * 100));

        wpmEl.textContent = (isFinite(wpm) ? wpm : 0);
        accEl.textContent = accuracy + '%';
        correctEl.textContent = correctChars;

        // ✅ End test automatically when passage is finished
        if(typed.length >= charElements.length){
            endTest();
        }
    }

    // Input events
    inputEl.addEventListener('input', () => {
      if(!running) return; // ignore when not running
      updateStats();
    });

    // Start button
    startBtn.addEventListener('click', () => {
      // if mode is words, force a fixed time but still allow selection (words mode uses selected number of words not time)
      startTest();
    });

    // Restart
    restartBtn.addEventListener('click', ()=>{
      clearInterval(timer);
      currentPassage = pickPassage();
      renderTarget(currentPassage);
      resetCounters();
    });

    // Keyboard: allow Enter to start when textarea focused and not running
    inputEl.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        // stop early
        if(running) endTest();
      }
    });

    // initialise
    (function init(){
      currentPassage = pickPassage();
      renderTarget(currentPassage);
    })();

    // Optional: allow pressing Space to start on mobile when textarea not focused
    document.addEventListener('keydown', (e)=>{
      if(e.key === ' ' && !running && document.activeElement !== inputEl){
        e.preventDefault();
        startTest();
      }
    });
  </script>
</body>
</html>
